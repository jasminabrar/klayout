This text file outlines how to use klayout with embedded gds factory on Mac M1 by using a linux (ubuntu 22) VM in UTM. UTM is a virtualization software for macOS and only for Apple platforms.

As of 10/17/2023 these instructions will allow you to run klayout with gdsfactory imported inside. Currently there are issues with running and displaying
gdsfactory code through the klayout macro python command line, since klayout freezes when .show() command is used.

Instructions
- create linux VM by following the tutorial video: https://www.youtube.com/watch?v=6mtfncj9vhU

- if experiencing issues connecting to the internet on VM:
	- Shut off VM -> VM settings in UTM (click on VM, click icon top right corner) -> Network -> change 	  Network Mode to ‘Emulated VAN’

- fork klayout GitHub repo, git clone repo 

- install all required packages to build klayout on linux (refer to https://www.klayout.de/build.html): 
	sudo apt-get update
	sudo apt-get install build-essential
	sudo apt-get install qtbase5-dev qttools5-dev libqt5xmlpatterns5-dev qtmultimedia5-dev 	  libqt5multimediawidgets5 libqt5svg5-dev
	sudo apt-get install ruby ruby-dev
	sudo apt-get install python3 python3-dev
	sudo apt-get install zlib1g-dev

- navigate to cloned klayout repo

- run build script:
	./build.sh

- install remaining gdstk dependencies that may not be already installed (refer to https://github.com/heitzmann/gdstk):
	sudo apt-get install qhull-bin
	sudo apt-get install cmake
	pip install numpy
	pip install sphinx

- pip install gplugins

- pip install gdsfactory

- navigate to bin-release folder in klayout repo

- Fix symbolic link error that will prevent you from running klayout:
	- sudo nano /etc/ld/so/conf 
	- add path to klayout/bin-release folder to end of file (e.g /home/user1/Documents/Github/klayout/bin-release)
	- sudo ldconfig 

- run klayout from command line:
	./klayout

- install klive and gdsfactory packages in klayout:
	- tools -> manage packages

- macros -> macro development -> import gdsfactory
